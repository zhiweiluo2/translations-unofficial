
.. _networkDashboardLink: https://dashboard.testnet.concordium.com/
.. _node-dashboard: http://localhost:8099
.. _Discord: https://discord.com/invite/xWmQ5tp

.. _become-a-baker:

==================================
成为baker（创建块）
==================================

.. contents::
   :local:
   :backlinks: none


本节说明面包师是什么，baker在网络中的角色以及如何成为面包师。

通过阅读本节，您将学到：

-  什么是baker及其相关概念。
-  如何升级您的节点成为面包师。

成为baker的过程可以概括为以下步骤：

   1. 获取一个帐户和一些GTU。
   2. 获取一组baker键。
   3. 将baker密钥注册到该帐户。
   4. 使用baker键启动节点。

完成这些步骤后，baker节点将烘烤块。如果将烘焙块添加到链中，则节点的baker将获得奖励。

.. 注意::

   在本节中，我们将使用名称bakerAccount作为将用于注册和管理baker的帐户的名称。

定义
===========

Baker
-----

节点通过创建添加到链中的新块积极参与网络时就是Baker（或正在烘烤）。Baker收集，订购和验证区块中包含的交易，以维护区块链的完整性。Baker对每个烘烤的块进行签名，以便网络的其他参与者可以检查和执行该块。

Baker 键
----------

每个Baker都有一组称为Baker密钥的加密密钥。节点使用这些键对它烘烤的块进行签名。为了烘焙由特定Baker签名的块，该节点必须在加载其Baker克密钥集的情况下运行。

Baker 账户
-------------

每个帐户可以使用一组Baker密钥来注册Baker。

每当Baker烘烤有效的区块（包含在链中）时，一段时间后就会向关联的帐户支付奖励。

赌注和彩票
-----------------

.. 全部的::

   - 链接到发布时间表.

该帐户可以将其GTU余额的一部分抵押到Baker股份中，然后可以手动释放所有或部分抵押额。在Baker释放之前，放样的金额不能移动或转移。

.. 注意::

   如果某个帐户拥有已通过下达进度计划转帐的金额，则即使尚未下达该金额，也可以放样。

为了被选择用于烘烤一块，Baker必须参加彩票，在该 彩票中获得中奖彩票的概率与所下注的数量大致成比例。

在计算Baker是否包含在最终委员会中时，使用相同的股份。请参阅完成。

.. _epochs-and-slots:

时代与空档
----------------

在Concordium区块链中，时间细分为slot。插槽的持续时间固定在“创世纪”块中。在任何给定的分支上，每个插槽最多可以有一个块，但是可以在同一插槽中产生不同分支上的多个块。

.. 全部的::

   让我们添加一张图片。

在考虑奖励和其他与烘焙相关的概念时，我们使用时期的概念作为时间单位，它定义了固定当前Baker和赌注的时间段。纪元的时长固定在“创世纪”块。在测试网中，纪元的持续时间为1小时。

开始烘烤
============

管理账户
-----------------

本节简要介绍了导入帐户的相关步骤。有关完整的说明，请参见：ref.`managing_accounts`。

使用：ref：`concordium_id`应用程序创建帐户。成功创建帐户后，导航至“更多”选项卡并选择“导出” 即可获取包含帐户信息的JSON文件。

要将帐户导入工具链运行

.. code-block:: console

   $ concordium-client配置帐户导入<路径/到/导出/文件> --name bakerAccount

concordium-client将要求输入密码以解密导出的文件并导入所有帐户。相同的密码将用于加密交易签名密钥和加密的转移密钥。

为 baker 创建密钥并注册
--------------------------------------------

.. 注意::

   对于此过程，该帐户需要拥有一些GTU，因此请确保在移动应用程序中请求该帐户的100 GTU下降。

每个帐户都有一个唯一的baker ID，该ID在注册其baker时使用。该ID必须由网络提供，并且当前无法预先计算。必须在baker密钥文件中将此ID赋予节点，以便它可以使用baker密钥创建块。concordium-client执行以下操作时，会自动填充此字段。

要创建一组新的键，请运行：

.. code-block:: console

  $concordium-client baker generate-keys <keys-file>.json

您可以在其中为密钥文件选择一个任意名称。要在网络中注册密钥，您需要：运行节点<running-a-node> 并将baker add事务发送到网络：

.. code-block:: console

   $concordium-client baker add <keys-file>.json --sender bakerAccount --stake <amountToStake> --out <concordium-data-dir>/baker-credentials.json

更换

- <amountToStake> 面包师初始股份的GTU金额
- <concordium-data-dir> 具有以下数据目录：
  * 在Linux和MacOS上： ~/.local/share/concordium
  * 在Windows上：%LOCALAPPDATA%\\concordium。

（输出文件名应保留baker-credentials.json）。

提供一个--no-restake标志，以避免自动将奖励添加到baker的抵押金额上。此行为在“重新获得收入”部分中进行了描述。

为了使用这些baker键启动节点并开始生成块，您首先需要关闭当前正在运行的节点（通过Ctrl + C在运行该节点的终端上按 或使用 concordium-node-stop可执行文件）。

将文件放置在适当的目录中之后（指定输出文件时已在上一个命令中完成），然后使用再次启动节点 concordium-node。当baker包含在当前时代的baker中时，该节点将自动开始烘焙。

此更改将立即执行，并且在将添加baker的事务包含在一个块中的那个之后的纪元完成时生效。

.. table:: 时间轴: 添加 baker

   +-------------------------------------------+-----------------------------------------+-----------------+
   |                                           | 当交易包含在区块中	                     | 2个时期后         |
   +===========================================+=========================================+=================+
   | 通过查询节点可以看到更改                    |  ✓                                     |                  |
   +-------------------------------------------+-----------------------------------------+-----------------+
   | baker被纳入烘焙委员会                      |                                         | ✓               |
   +-------------------------------------------+-----------------------------------------+-----------------+

.. 注意::

  如果在阶段E的某个区块中包含添加面包师的事务，则在纪元E + 2开始时，该面包师将被视为烘焙委员会的一部分。

管理baker
==================

检查面包师的状态及其彩票能力
------------------------------------------------------

为了查看节点是否正在烘焙，您可以检查显示的信息中提供不同精确度的各种来源。

- 在网络仪表板中，您的节点将在Baker列中显示其BakerID 。
- 使用，concordium-client您可以检查当前Baker的列表以及他们持有的相对赌注数量，即他们的彩票能力。彩票的力量将决定给定的Baker赢得彩票并烘烤一个块的可能性。

  .. code-block:: console

     $concordium-client consensus show-parameters --include-bakers
     Election nonce:      07fe0e6c73d1fff4ec8ea910ffd42eb58d5a8ecd58d9f871d8f7c71e60faf0b0
     Election difficulty: 4.0e-2
     Bakers:
                                  Account                       Lottery power
             ----------------------------------------------------------------
         ...
         34: 4p2n8QQn5akq3XqAAJt2a5CsnGhDvUon6HExd2szrfkZCTD4FX   <0.0001
         ...

- 使用，concordium-client您可以检查帐户是否已注册baker以及该baker已抵押的当前金额。

  .. code-block:: console

     $./concordium-client 账户显示 baker账户
     ...

     Baker: #22
      - Staked amount: 10.000000 GTU
      - Restake earnings: yes
     ...

- 如果放样量足够大，并且有一个节点在加载了baker密钥，则该baker最终将产生区块，您可以在移动钱包中看到该帐户正在收到烘烤奖励，如下图所示：

  .. image:: images/bab-reward.png
     :align: center
     :width: 250px

更新抵押金额
--------------------------

要更新baker的股份运行

.. code-block:: console

   $concordium-client baker update-stake --stake <newAmount> --sender bakerAccount

修改放样量将修改选择baker烘烤块的概率。

当baker第一次增加股份或增加股份时，该更改将在链上执行，并在交易包含在一个区块中（可以通过看到concordium-client account show bakerAccount）后立即可见，并在此之后的2个星期生效。
.. table:: 时间轴: 增加赌注

   +----------------------------------------+-----------------------------------------+----------------+
   |                                        | 当交易包含在区块中                        | 2个时期后       |
   +========================================+=========================================+================+
   | 通过查询节点可以看到更改                  | ✓                                       |                |
   +----------------------------------------+-----------------------------------------+----------------+
   | Baker 使用新股份                        |                                         | ✓              |
   +----------------------------------------+-----------------------------------------+----------------+

当baker减少放样量时，更改将需要2 + bakerCooldownEpochs个纪元才能生效。一旦将交易包含在一个区块中，就可以在链上看到更改，可以通过以下方式进行查询 concordium-client account show bakerAccount：

.. code-block:: console

   $concordium-client account show bakerAccount
   ...

   Baker: #22
    - Staked amount: 50.000000 GTU to be updated to 20.000000 GTU at epoch 261  (2020-12-24 12:56:26 UTC)
    - Restake earnings: yes

   ...

.. table:: 时间线：减少赌注

   +----------------------------------------+-----------------------------------------+----------------------------------------+
   |                                        |当交易包含在区块中                         | 2 +baker后冷却史时代                    |
   +========================================+=========================================+========================================+
   | 通过查询节点可以看到更改                 | ✓                                       |                                        |
   +----------------------------------------+-----------------------------------------+----------------------------------------+
   | Baker使用新股份                         |                                         | ✓                                      |
   +----------------------------------------+-----------------------------------------+----------------------------------------+
   | 放样可以再次减少或Baker可以去除          |                                         |                                        |
   +----------------------------------------+-----------------------------------------+----------------------------------------+

.. 注意::

  在测试网中，bakerCooldownEpochs最初设置为168个纪元。可以按以下方式检查此值：

   .. code-block:: console

      $concordium-client raw GetBlockSummary
      ...
              "bakerCooldownEpochs": 168
      ...

.. 警告::

  如“定义”部分所述，放样金额已锁定，即无法转移或用于付款。您应该考虑到这一点，并考虑存入短期内不需要的金额。特别是，要注销Baker或更改抵押金额，您需要拥有一些未抵押的GTU来支付交易费用。

重新取得收益
----------------------

当以baker的身份参加网络和烘焙块时，该帐户将在每个烘焙块上获得奖励。默认情况下，这些奖励会自动添加到放样金额中。

您可以选择修改此行为，而无需自动投入即可获得帐户余额中的奖励。可以通过concordium-client以下方式更改此开关：

.. code-block:: console

   $concordium-client baker update-restake False --sender bakerAccount
   $concordium-client baker update-restake True --sender bakerAccount

对restake标志的更改将立即生效；然而，这些变化开始影响下一个时代的烘烤和终结能力。开关的当前值可以在帐户信息中看到，可以使用concordium-client以下命令查询：

.. code-block:: console

   $concordium-client account show bakerAccount
   ...

   Baker: #22
    - Staked amount: 50.000000 GTU
    - Restake earnings: yes

   ...

.. table:: 时间轴：更新restake

   +-----------------------------------------------+-----------------------------------------+-------------------------------+
   |                                               | 当交易包含在区块中	                       | 奖励后2个纪元                  |
   +===============================================+=========================================+===============================+
   | 通过查询节点可以看到更改                        | ✓                                       |                               |
   +-----------------------------------------------+-----------------------------------------+-------------------------------+
   | 收入将不会自动重新调整                          | ✓                                       |                               |
   +-----------------------------------------------+-----------------------------------------+-------------------------------+
   | 如果自动重购，获得的本金会影响彩票能力            |                                         |                               |
   +-----------------------------------------------+-----------------------------------------+-------------------------------+

注册baker后，它将自动重新获取收入，但是如上所述，可以通过为命令提供--no-restake标志来更改此收入，baker add如下所示：

.. code-block:: console

   $concordium-client baker add baker-keys.json --sender bakerAccount --stake <amountToStake> --out baker-credentials.json --no-restake

定案
------------

敲定是指敲定委员会中的节点执行的表决过程，当委员会中有足够多的成员收到该方框并就其结果达成一致时，该方框将敲定该方框。较新的块必须具有最终块作为祖先，以确保链的完整性。有关此过程的更多信息，请参见 ：finalization <glossary-finalization>部分。

敲定委员会由拥有一定赌注的面包师组成。这特别意味着，要参加定稿委员会，您可能必须修改抵押金额才能达到上述阈值。在测试网中，参与定稿委员会所需的赌注金额为现有GTU总额的0.1％。

参与定稿委员会会在定稿的每个区块上产生奖励。奖励将在区块完成后的某个时间支付给面包师账户。

取出 a baker
================

控制帐户可以选择在链上注销其面包师。为此，您必须执行concordium-client：

.. code-block:: console

   $concordium-client baker remove --sender bakerAccount

这会将面包师从面包师列表中删除，并解锁面包师上的放样金额，以便可以自由转移或移动它。

移除面包师时，更改的时间与减少放样的时间相同。更改将需要2个以上的bakerCooldownEpochs纪元才能生效。一旦将交易包含在一个区块中，该更改就会在链上可见，您可以通过concordium-client照常查询帐户信息来检查此更改何时生效：

.. code-block:: console

   $concordium-client account show bakerAccount
   ...

   Baker #22 to be removed at epoch 275 (2020-12-24 13:56:26 UTC)
    - Staked amount: 20.000000 GTU
    - Restake earnings: yes

   ...

.. table:: 时间轴：移除baker

   +--------------------------------------------+-----------------------------------------+----------------------------------------+
   |                                            | 当交易包含在区块中                        | 2 + baker 后冷却史时代                  |
   +============================================+=========================================+========================================+
   | 通过查询节点可以看到更改                     | ✓                                       |                                        |
   +--------------------------------------------+-----------------------------------------+----------------------------------------+
   | Baker 贝克被从烘焙委员会中移除               |                                         | ✓                                      |
   +--------------------------------------------+-----------------------------------------+----------------------------------------+

.. 警告::

  减少放样量和移除 baker 不能同时进行。在通过减少放样量而产生的冷却期间，无法移除 baker，反之亦然。

支持与反馈
==================

I如果您遇到任何问题或建议，请在Discord上发布您的问题或反馈，或通过testnet@concordium.com与我们联系。
